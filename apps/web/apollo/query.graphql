fragment author on Author {
  __typename
  id
  name
  meta {
    type
    job
    org
    sites {
      name
      url
    }
  }
}

# # fragment note on Note {
# #   __typename
# #   id
# #   link {
# #     ...link
# #   }
# #   meta {
# #     ...noteMeta
# #   }
# #   sym {
# #     ...sym
# #   }
# #   updatedAt
# # }

# # fragment noteDigest on NoteDigest {
# #   __typename
# #   commitId
# #   noteId
# #   noteMeta {
# #     ...noteMeta
# #   }
# #   fromNoteId
# #   sym {
# #     ...sym
# #   }
# #   subSyms {
# #     ...sym
# #   }
# #   picks
# #   updatedAt
# # }

# # fragment noteMeta on NoteMeta {
# #   __typename
# #   author
# #   duplicates
# #   keywords
# #   publishedAt
# #   redirect
# #   tickers
# #   title
# #   url
# # }

# # fragment noteState on NoteState {
# #   __typename
# #   id
# #   noteId
# #   userId
# #   commitId
# #   prevId
# #   body {
# #     prevStateId
# #     sourceNoteId
# #     changes
# #     value
# #   }
# #   updatedAt
# # }

fragment commit on Commit {
  __typename
  id
  userId
  drafts {
    ...noteDraft
  }
  docs {
    ...noteDoc
  }
  updatedAt
}

fragment discuss on Discuss {
  __typename
  id
  userId
  status
  meta
  title
  content
  createdAt
  updatedAt
  count {
    id
    nPosts
  }
}

fragment discussEmoji on DiscussEmoji {
  __typename
  id
  code
  count {
    ...discussEmojiCount
  }
}

fragment discussEmojiCount on DiscussEmojiCount {
  __typename
  id
  nUps
}

fragment discussEmojiLike on DiscussEmojiLike {
  __typename
  id
  discussEmojiId
  liked
  updatedAt
}

fragment discussPost on DiscussPost {
  __typename
  id
  userId
  status
  content
  createdAt
  updatedAt
}

fragment discussPostEmoji on DiscussPostEmoji {
  __typename
  id
  code
  count {
    ...discussPostEmojiCount
  }
}

fragment discussPostEmojiCount on DiscussPostEmojiCount {
  __typename
  id
  nUps
}

fragment discussPostEmojiLike on DiscussPostEmojiLike {
  __typename
  id
  discussPostEmojiId
  liked
  updatedAt
}

fragment link on Link {
  __typename
  id
  url
  authorId
}

fragment noteEmoji on NoteEmoji {
  __typename
  id
  code
  count {
    ...noteEmojiCount
  }
}

fragment noteEmojiCount on NoteEmojiCount {
  __typename
  id
  nUps
  nDowns
}

fragment noteEmojiLike on NoteEmojiLike {
  __typename
  id
  noteEmojiId
  liked
  updatedAt
}

fragment poll on Poll {
  __typename
  id
  userId
  choices
  count {
    id
    nVotes
  }
  createdAt
  updatedAt
}

fragment rate on Rate {
  __typename
  id
  userId
  authorId
  linkId
  symId
  choice
  createdAt
  updatedAt
}

fragment searchHit on SearchHit {
  id
  str
}

fragment sym on Sym {
  __typename
  id
  type
  symbol
}

fragment user on User {
  __typename
  id
  email
}

fragment vote on Vote {
  __typename
  id
  pollId
  choiceIdx
}

# -----------NEW-----------
fragment note on Note {
  __typename
  id
  branch
  sym {
    ...sym
  }
  link {
    ...link
  }
  doc {
    ...noteDoc
  }
  updatedAt
}

fragment noteDoc on NoteDoc {
  __typename
  id
  commitId
  fromDocId
  userId
  status
  domain
  meta {
    ...noteDocMeta
  }
  content {
    ...noteDocContent
  }
  updatedAt
}

fragment noteDocContent on NoteDocContent {
  discussIds {
    blockUid
    discussId
    commitId
  }
  diff
  symbolIdDict
  blocks {
    uid
    str
    parentUid
    docTitle
  }
}

fragment noteDocEntry on NoteDocEntry {
  __typename
  id
}

fragment noteDocMeta on NoteDocMeta {
  duplicatedSymbols
  keywords
  redirectFroms
  redirectTo
  webpage {
    ...noteDocMetaWebpage
  }
}

fragment noteDocMetaWebpage on NoteDocMetaWebpage {
  authors
  title
  publishedAt
  tickers
}

fragment noteDraft on NoteDraft {
  __typename
  id
  userId
  commitId
  fromDocId
  domain
  symbol
  meta {
    ...noteDocMeta
  }
  content {
    ...noteDocContent
  }
  updatedAt
  status
}

fragment noteDraftCommitResponse on NoteDraftCommitResponse {
  __typename
  commitId
  docs {
    ...noteDoc
  }
}

fragment noteDraftDropResponse on NoteDraftDropResponse {
  __typename
  response
}

fragment noteDraftEntry on NoteDraftEntry {
  __typename
  id
}

#--------------END------------------

query Author($id: ID, $name: String) {
  author(id: $id, name: $name) {
    ...author
  }
}

query Discuss($id: ID!) {
  discuss(id: $id) {
    ...discuss
  }
}

query DiscussEmojis($discussId: ID!) {
  discussEmojis(discussId: $discussId) {
    ...discussEmoji
  }
}

query DiscussPosts($discussId: ID!) {
  discussPosts(discussId: $discussId) {
    ...discussPost
  }
}

query DiscussPostEmojis($discussPostId: ID!) {
  discussPostEmojis(discussPostId: $discussPostId) {
    ...discussPostEmoji
  }
}

query Link($id: ID, $url: String) {
  link(id: $id, url: $url) {
    ...link
  }
}

query Me {
  me {
    ...user
  }
}

query MyNoteEmojiLike($noteEmojiId: ID!) {
  myNoteEmojiLike(noteEmojiId: $noteEmojiId) {
    ...noteEmojiLike
  }
}

query MyDiscussEmojiLike($discussEmojiId: ID!) {
  myDiscussEmojiLike(discussEmojiId: $discussEmojiId) {
    ...discussEmojiLike
  }
}

query MyDiscussPostEmojiLike($discussPostEmojiId: ID!) {
  myDiscussPostEmojiLike(discussPostEmojiId: $discussPostEmojiId) {
    ...discussPostEmojiLike
  }
}

query MyRates($symId: ID!) {
  myRates(symId: $symId) {
    ...rate
  }
}

query MyVotes($pollId: ID!) {
  myVotes(pollId: $pollId) {
    ...vote
  }
}

query NoteEmojis($noteId: ID!) {
  noteEmojis(noteId: $noteId) {
    ...noteEmoji
  }
}

query Poll($id: ID!) {
  poll(id: $id) {
    ...poll
  }
}

query Rate($id: ID!) {
  rate(id: $id) {
    ...rate
  }
}

query RatesByAuthor($authorId: ID!, $symId: ID!) {
  ratesByAuthor(authorId: $authorId, symId: $symId) {
    ...rate
  }
}

query RatesBySource($linkId: ID!) {
  ratesBySource(linkId: $linkId) {
    ...rate
  }
}

query SearchAuthor($term: String!) {
  searchAuthor(term: $term) {
    ...searchHit
  }
}

query SearchDiscuss($term: String!) {
  searchDiscuss(term: $term) {
    ...searchHit
  }
}

query SearchSymbol($term: String!, $type: SymType) {
  searchSymbol(term: $term, type: $type) {
    ...searchHit
  }
}

# # --------NEW--------
query MyCommits {
  myCommits {
    ...commit
  }
}

query MyNoteDraftEntries {
  myNoteDraftEntries {
    ...noteDraftEntry
  }
}

query NoteById($id: ID!) {
  noteById(id: $id) {
    ...note
  }
}

query NoteByBranchSymbol($branch: String!, $symbol: String!) {
  noteByBranchSymbol(branch: $branch, symbol: $symbol) {
    ...note
  }
}

query NoteDoc($id: ID!) {
  noteDoc(id: $id) {
    ...noteDoc
  }
}

query NoteDocsJustMerged {
  noteDocsJustMerged {
    ...noteDoc
  }
}

query NoteDocsToMerge {
  noteDocsToMerge {
    ...noteDoc
  }
}

query NoteDraft($id: ID, $symbol: String, $url: String) {
  noteDraft(id: $id, symbol: $symbol, url: $url) {
    ...noteDraft
  }
}

query NoteHistory($noteId: ID!, $status: NoteDocStatus) {
  noteHistory(noteId: $noteId, status: $status) {
    ...noteDocEntry
  }
}

query SearchNote($symbol: String, $title: String, $domain: String) {
  searchNote(symbol: $symbol, title: $title, domain: $domain) {
    ...note
  }
}

# #-----------END----------------

#----------Mutation------------
# TODO: need to modify
mutation CreateAuthor($data: AuthorInput!) {
  createAuthor(data: $data) {
    ...author
  }
}

mutation UpdateAuthor($id: ID!, $data: AuthorInput!) {
  updateAuthor(id: $id, data: $data) {
    ...author
  }
}

mutation CreateDiscuss($noteId: ID, $data: DiscussInput!) {
  createDiscuss(noteId: $noteId, data: $data) {
    ...discuss
  }
}

mutation UpdateDiscuss($id: ID!, $data: DiscussInput!) {
  updateDiscuss(id: $id, data: $data) {
    ...discuss
  }
}

mutation UpsertDiscussEmojiLike(
  $liked: Boolean!
  $emojiId: Int
  $emojiCode: EmojiCode
  $discussId: String
) {
  upsertDiscussEmojiLike(
    liked: $liked
    emojiId: $emojiId
    emojiCode: $emojiCode
    discussId: $discussId
  ) {
    emoji {
      ...discussEmoji
    }
    like {
      ...discussEmojiLike
    }
  }
}

mutation CreateDiscussPost($discussId: ID!, $data: DiscussPostInput!) {
  createDiscussPost(discussId: $discussId, data: $data) {
    ...discussPost
  }
}

mutation UpdateDiscussPost($id: ID!, $data: DiscussPostInput!) {
  updateDiscussPost(id: $id, data: $data) {
    ...discussPost
  }
}

mutation UpsertDiscussPostEmojiLike(
  $liked: Boolean!
  $emojiId: Int
  $emojiCode: EmojiCode
  $discussPostId: Int
) {
  upsertDiscussPostEmojiLike(
    liked: $liked
    emojiId: $emojiId
    emojiCode: $emojiCode
    discussPostId: $discussPostId
  ) {
    emoji {
      ...discussPostEmoji
    }
    like {
      ...discussPostEmojiLike
    }
  }
}

mutation UpsertNoteEmojiLike(
  $liked: Boolean!
  $emojiId: Int
  $emojiCode: EmojiCode
  $noteId: String
) {
  upsertNoteEmojiLike(
    liked: $liked
    emojiId: $emojiId
    emojiCode: $emojiCode
    noteId: $noteId
  ) {
    emoji {
      ...noteEmoji
    }
    like {
      ...noteEmojiLike
    }
  }
}

mutation CreatePoll($data: PollInput!) {
  createPoll(data: $data) {
    ...poll
  }
}

mutation CreateRate($data: RateInput!) {
  createRate(data: $data) {
    ...rate
  }
}

mutation UpdateRate($id: ID!, $data: RateInput!) {
  updateRate(id: $id, data: $data) {
    ...rate
  }
}

mutation CreateVote($pollId: ID!, $data: VoteInput!) {
  createVote(pollId: $pollId, data: $data) {
    ...vote
  }
}

mutation SessionLogin($idToken: String!) {
  sessionLogin(idToken: $idToken) {
    ...user
  }
}

mutation SessionLogout {
  sessionLogout
}

# ------------- NEW ------------

mutation CommitNoteDrafts($draftIds: [ID!]!) {
  commitNoteDrafts(draftIds: $draftIds) {
    ...noteDraftCommitResponse
  }
}

mutation CreateNoteDraft(
  $branch: String!
  $symbol: String!
  $draftInput: NoteDraftInput!
) {
  createNoteDraft(branch: $branch, symbol: $symbol, draftInput: $draftInput) {
    ...noteDraft
  }
}

mutation CreateNoteDraftByLink(
  $branch: String!
  $linkId: String!
  $draftInput: NoteDraftInput!
) {
  createNoteDraftByLink(
    branch: $branch
    linkId: $linkId
    draftInput: $draftInput
  ) {
    ...noteDraft
  }
}

mutation UpdateNoteDraft($id: ID!, $data: NoteDraftInput!) {
  updateNoteDraft(id: $id, data: $data) {
    ...noteDraft
  }
}

mutation DropNoteDraft($id: ID!) {
  dropNoteDraft(id: $id) {
    ...noteDraftDropResponse
  }
}
